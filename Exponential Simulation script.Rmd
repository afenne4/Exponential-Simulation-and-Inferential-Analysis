---
title: "Exponential Simulation and Inference"
author: "Alex Fennell"
date: "2/11/2022"
output: pdf_document
---

# Simulating the Exponential distribution

## Synopsis
This project will compare how statistics of a non-normal distribution are 
themselves normally distributed. A Monte Carlo procedure will be used to simulate
distributions of the mean and variance of the exponential distribution
which will then be compared to the theoretical mean and standard deviation of the
distribution. 

```{r,message=FALSE}
library(ggplot2)
library(gridExtra)
library(cowplot)
```

## Simulations
This simulation will use samples of size 40 with lambda=.2. There will be 1000
simulations to create a distribution

``` {r}
lambda=.2
#Number of Monte Carlo samples
S=1000
#size of Monte Carlo samples
n=40
#samples stored in matrix where columns are the size of the monte carlo samples
#and each row is an individual simulation
sim<-matrix(rexp(n*S,lambda),nrow=S,ncol=n)

```

## Sample Mean vs. Theoretical Mean
This next chunk of code will show a plot of the means from the Monte Carlo 
simulation with the theoretical mean overlayed as a dashed red vertical line. The
theoretical mean is calculated as 1/lambda
``` {r}
# Theoretical mean
Tmean<-1/lambda
Tmean<-data.frame(Type="Theoretical Mean",val=Tmean)

# The function rowMeans calulates the mean for each row (one simulation), which 
#creates a distribution of means based on the Monte Carlo simulation
simmean<-data.frame(means=rowMeans(sim))
# standardize bin width for all plots
binsize=.2
#combine mean and theoretical mean into one dataframe
meanplot<-ggplot(data=simmean,aes(means))+
    ggtitle("Distribution of Means \nof Exponential Simulation") +
    xlab("Means")+
    theme(plot.title = element_text(hjust = 0.5),
          legend.title=element_blank())
    

meanplot+geom_histogram(aes(y=..count..),binwidth = binsize,color="black",fill="lightblue")+
    geom_vline(data=Tmean,aes(xintercept=val,color=Type),linetype="dashed",size=1.5)

```

This histogram shows that the distibution of means sampled from the exponential
distribution is roughly normal with the highest density of responses centered 
around the theoretical mean (vertical red dashed line).

## Sample Variance vs. Theoretical Variance
This next chunk of code will show a plot of the variance and standard deviation
from the Monte Carlo simulation with the theoretical variance and standard deviation
overlayed as a dashed red vertical line. The theoretical variance for exponential 
distribution is calculated as E(Var)=1/lambda^2. The theoretical standard deviation
is then just sqrt(E(Var))
``` {r}
#Theoretical variance
Tvar<-(1/lambda^2)
Tvar<-data.frame(Type="Theoretical Variance",val=Tvar)
# Using the apply function to calculate the variance for each row (one simulation),
# which creates a distribution of simulated variances
simvar<-data.frame(VAR=apply(sim,1,var))

varplot<-ggplot(data=simvar,aes(VAR))+
    ggtitle("Distribution of Variance \nof Exponential Simulation") +
    xlab("Variance")+
    theme(plot.title = element_text(hjust = 0.5),
          legend.title=element_blank())

varplot1<-varplot+
    geom_histogram(aes(y=..count..),binwidth=2.5,color="black",fill="darkgreen")+
    geom_vline(data=Tvar,aes(xintercept=val,color=Type),linetype="dashed",size=1.5) 


#Theoretical SD
 Tsd<-sqrt(Tvar$val)
 Tsd<-data.frame(Type="Theoretical SD",val=Tsd)
 
 # Using the apply function to calculate the SD for each row (one simulation),
 # which creates a distribution of simulated SDs
 simsd<-data.frame(SD=apply(sim,1,sd))
 
 sdplot<-ggplot(data=simsd,aes(SD))+
     ggtitle("Distribution of Standard Deviation \nof Exponential Simulation") +
     xlab("Standard Deviation")+
     theme(plot.title = element_text(hjust = 0.5),
           legend.title=element_blank())
 
 sdplot1<-sdplot+
     geom_histogram(aes(y=..count..),binwidth=binsize,color="black",fill="lightgreen")+
     geom_vline(data=Tsd,aes(xintercept=val,color=Type),linetype="dashed",size=1.5)
 
 grid.arrange(varplot1,sdplot1,nrow=2)

```


## Normality of Simulated Statistics
We will now examine the distribution of the mean, variance, and standard deviation
of the Monte Carlo Simulations to see how close they approximate a normal distribution
and conform to the central limit theorem. We will do this in two ways. The first
is to overlay a normal PDF on the histograms, and the second is to use a QQplot.
The QQplot is nice because it provides a very obvious comparison of data to the
theoretical normal distribution. Simulated data that does not fall on the diagonal 
reference line does not conform to a normal distribution, with larger deviations
indicating a greater departure from normality.

```{r}
    meanplot+
    geom_histogram(aes(y=..density..),binwidth = binsize,color="black",fill="lightblue")+
    geom_vline(data=Tmean,aes(xintercept=val,color=Type),linetype="dashed",size=1.5)+
    stat_function(fun=dnorm,lwd=1.5,args=list(mean=mean(simmean$means),
                                              sd=mean(simsd$SD)/sqrt(n)))


```
